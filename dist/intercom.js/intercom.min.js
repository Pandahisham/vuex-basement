"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var Intercom = function () {
  var t = function t() {};t.createInterface = function (t) {
    var e = {};return e.on = function (e, n) {
      "undefined" == typeof this[t] && (this[t] = {}), this[t].hasOwnProperty(e) || (this[t][e] = []), this[t][e].push(n);
    }, e.off = function (e, n) {
      "undefined" != typeof this[t] && this[t].hasOwnProperty(e) && r.removeItem(n, this[t][e]);
    }, e.trigger = function (e) {
      if ("undefined" != typeof this[t] && this[t].hasOwnProperty(e)) for (var n = Array.prototype.slice.call(arguments, 1), i = 0; i < this[t][e].length; i++) {
        this[t][e][i].apply(this[t][e][i], n);
      }
    }, e;
  };var e = t.createInterface("_handlers");t.prototype._on = e.on, t.prototype._off = e.off, t.prototype._trigger = e.trigger;var n = t.createInterface("handlers");t.prototype.on = function () {
    n.on.apply(this, arguments), Array.prototype.unshift.call(arguments, "on"), this._trigger.apply(this, arguments);
  }, t.prototype.off = n.off, t.prototype.trigger = n.trigger;var i = window.localStorage;"undefined" == typeof i && (i = { getItem: function getItem() {}, setItem: function setItem() {}, removeItem: function removeItem() {} });var r = {};r.guid = function () {
    var t = function t() {
      return (65536 * (1 + Math.random()) | 0).toString(16).substring(1);
    };return function () {
      return t() + t() + "-" + t() + "-" + t() + "-" + t() + "-" + t() + t() + t();
    };
  }(), r.throttle = function (t, e) {
    var n = 0;return function () {
      var i = new Date().getTime();i - n > t && (n = i, e.apply(this, arguments));
    };
  }, r.extend = function (t, e) {
    if ("undefined" != typeof t && t || (t = {}), "object" == (typeof e === "undefined" ? "undefined" : _typeof(e))) for (var n in e) {
      e.hasOwnProperty(n) && (t[n] = e[n]);
    }return t;
  }, r.removeItem = function (t, e) {
    for (var n = e.length - 1; n >= 0; n--) {
      e[n] === t && e.splice(n, 1);
    }return e;
  };var o = function o() {
    var t = this,
        e = new Date().getTime();this.origin = r.guid(), this.lastMessage = e, this.bindings = [], this.receivedIDs = {}, this.previousValues = {};var n = function n() {
      t._onStorageEvent.apply(t, arguments);
    };window.attachEvent ? document.attachEvent("onstorage", n) : window.addEventListener("storage", n, !1);
  };o.prototype._transaction = function (t) {
    var e = 1e3,
        n = 20,
        r = this,
        o = !1,
        a = !1,
        s = null,
        u = function u() {
      if (!o) {
        var c = new Date().getTime(),
            g = parseInt(i.getItem(f) || 0);if (g && c - g < e) return a || (r._on("storage", u), a = !0), void (s = window.setTimeout(u, n));o = !0, i.setItem(f, c), t(), p();
      }
    },
        p = function p() {
      a && r._off("storage", u), s && window.clearTimeout(s), i.removeItem(f);
    };u();
  }, o.prototype._cleanup_emit = r.throttle(100, function () {
    this._transaction(function () {
      for (var t = new Date().getTime(), e = t - u, n = 0, r = JSON.parse(i.getItem(a) || "[]"), o = r.length - 1; o >= 0; o--) {
        r[o].timestamp < e && (r.splice(o, 1), n++);
      }n > 0 && i.setItem(a, JSON.stringify(r));
    });
  }), o.prototype._cleanup_once = r.throttle(100, function () {
    var t = this;this._transaction(function () {
      var e,
          n = JSON.parse(i.getItem(s) || "{}"),
          r = (new Date().getTime(), 0);for (e in n) {
        t._once_expired(e, n) && (delete n[e], r++);
      }r > 0 && i.setItem(s, JSON.stringify(n));
    });
  }), o.prototype._once_expired = function (t, e) {
    if (!e) return !0;if (!e.hasOwnProperty(t)) return !0;if ("object" != _typeof(e[t])) return !0;var n = e[t].ttl || p,
        i = new Date().getTime(),
        r = e[t].timestamp;return r < i - n;
  }, o.prototype._localStorageChanged = function (t, e) {
    if (t && t.key) return t.key === e;var n = i.getItem(e);return n !== this.previousValues[e] && (this.previousValues[e] = n, !0);
  }, o.prototype._onStorageEvent = function (t) {
    t = t || window.event;var e = this;this._localStorageChanged(t, a) && this._transaction(function () {
      for (var t = new Date().getTime(), n = i.getItem(a), r = JSON.parse(n || "[]"), o = 0; o < r.length; o++) {
        if (r[o].origin !== e.origin && !(r[o].timestamp < e.lastMessage)) {
          if (r[o].id) {
            if (e.receivedIDs.hasOwnProperty(r[o].id)) continue;e.receivedIDs[r[o].id] = !0;
          }e.trigger(r[o].name, r[o].payload);
        }
      }e.lastMessage = t;
    }), this._trigger("storage", t);
  }, o.prototype._emit = function (t, e, n) {
    if (n = "string" == typeof n || "number" == typeof n ? String(n) : null, n && n.length) {
      if (this.receivedIDs.hasOwnProperty(n)) return;this.receivedIDs[n] = !0;
    }var r = { id: n, name: t, origin: this.origin, timestamp: new Date().getTime(), payload: e },
        o = this;this._transaction(function () {
      var t = i.getItem(a) || "[]",
          e = "[]" === t ? "" : ",";t = [t.substring(0, t.length - 1), e, JSON.stringify(r), "]"].join(""), i.setItem(a, t), window.setTimeout(function () {
        o._cleanup_emit();
      }, 50);
    });
  }, o.prototype.bind = function (t, e) {
    for (var n = 0; n < o.bindings.length; n++) {
      var i = o.bindings[n].factory(t, e || null, this);i && this.bindings.push(i);
    }
  }, o.prototype.emit = function (t, e) {
    this._emit.apply(this, arguments), this._trigger("emit", t, e);
  }, o.prototype.once = function (t, e, n) {
    if (o.supported) {
      var r = this;this._transaction(function () {
        var o = JSON.parse(i.getItem(s) || "{}");r._once_expired(t, o) && (o[t] = {}, o[t].timestamp = new Date().getTime(), "number" == typeof n && (o[t].ttl = 1e3 * n), i.setItem(s, JSON.stringify(o)), e(), window.setTimeout(function () {
          r._cleanup_once();
        }, 50));
      });
    }
  }, r.extend(o.prototype, t.prototype), o.bindings = [], o.supported = "undefined" != typeof i;var a = "vuex-basement-intercom",
      s = "vuex-basement-intercom_once",
      f = "vuex-basement-intercom_lock",
      u = 5e4,
      p = 36e5;o.destroy = function () {
    i.removeItem(f), i.removeItem(a), i.removeItem(s);
  }, o.getInstance = function () {
    var t = null;return function () {
      return t || (t = new o()), t;
    };
  }();var c = function c(t, e, n) {
    if (e = r.extend({ id: null, send: !0, receive: !0 }, e), e.receive) {
      var i = [],
          o = function o(r, _o) {
        i.indexOf(r) === -1 && (i.push(r), t.on(r, function (t) {
          var i = "function" == typeof e.id ? e.id(r, t) : null,
              o = "function" != typeof e.receive || e.receive(r, t);(o || "boolean" != typeof o) && n._emit(r, t, i);
        }));
      };for (var a in n.handlers) {
        for (var s = 0; s < n.handlers[a].length; s++) {
          o(a, n.handlers[a][s]);
        }
      }n._on("on", o);
    }e.send && n._on("emit", function (n, i) {
      var r = "function" != typeof e.send || e.send(n, i);(r || "boolean" != typeof r) && t.emit(n, i);
    });
  };return c.factory = function (t, e, n) {
    return "undefined" != typeof t.socket && new c(t, e, n);
  }, o.bindings.push(c), o;
}();